server.port=${port:8080}
spring.rabbitmq.host=rabbitmq
spring.application.name=shipping

# Actuator endpoints configuration (Spring Boot 3.x)
# Remove /actuator prefix to expose endpoints at root level
management.endpoints.web.base-path=/
management.endpoints.web.exposure.include=health,prometheus,chaosmonkey
management.endpoint.health.enabled=true
management.endpoint.prometheus.enabled=true
management.endpoint.metrics.enabled=false
management.endpoint.chaosmonkey.enabled=true
# Path mappings: /health, /metrics at root, chaosmonkey under /actuator
management.endpoints.web.path-mapping.prometheus=metrics
management.endpoints.web.path-mapping.chaosmonkey=actuator/chaosmonkey

# Micrometer Tracing (replaces Spring Cloud Sleuth)
management.tracing.sampling.probability=1.0
management.zipkin.tracing.endpoint=http://${zipkin_host:jaeger-collector.observability.svc.cluster.local}:9411/api/v2/spans
management.tracing.enabled=${zipkin_enabled:true}

# Exclude health checks and actuator endpoints from tracing
management.tracing.sampling.exclude-patterns=/health,/actuator/**,/metrics,/prometheus

# Logging pattern with explicit traceId and spanId labels
logging.pattern.level=%5p [${spring.application.name:},traceId:%X{traceId:-},spanId:%X{spanId:-}]
logging.pattern.console=%d{yyyy-MM-dd'T'HH:mm:ss.SSSXXX} %5p [${spring.application.name:},traceId:%X{traceId:-},spanId:%X{spanId:-}] --- [%15.15t] %-40.40logger{39} : %m%n

# Enable Chaos Monkey Spring profile
spring.profiles.active=${SPRING_PROFILES_ACTIVE:chaos-monkey}

# --- Chaos Monkey Configuration ---
chaos.monkey.enabled=true

# Watcher: enable aspects for service and controller layers
chaos.monkey.watcher.service=true
chaos.monkey.watcher.rest-controller=true

# Assaults: disabled by default, controlled externally (e.g., Litmus)
chaos.monkey.assaults.latency-active=false
chaos.monkey.assaults.exceptions-active=false
chaos.monkey.assaults.kill-application-active=false